{% extends "base.html" %}
{% load static %}

{% block title %} DameVino - Vinoteca {% endblock %}

{% block content %}

<div class="container-fluid px-5 py-5" >
    <div id="colD" class="row py-5" style="background-color: #a1ded6;">
        <div class="col-md-3">
            <form id="f" method="GET">
                <!--{% csrf_token %}-->
                <div class="list-group">
                    <label>Tipo de vino</label>
                    <input name="tVino" id="tVino" type="text">
                </div>
                <div class="list-group">
                    <h3>Puntuaci√≥n</h3>
                    <div class="list-group-item">
                        <div class="slidecontainer">
                            <input type="range" min="1" max="100" value="50" class="slider" id="myRange">
                            <p>Puntos: <span id="demo"></span></p>
                        </div>
                    </div>
                </div>
                <div class="list-group">
                    <button type="submit" class="btn boton">Aplicar filtros</button>
                </div>
            </form>    
        </div>
        <div class="col-md-9 d-flex justify-content-center" id="grupoVinos">
            <div class="card results" id="cartas">
                {% if vinos %}
                    {% for vino in vinos %}
                        <div class="row no-gutters">
                            <div class="col-md-4">
                                <img src={{vino.img}} width="200" height="200" style="margin: 1em;" class="card-img" alt="...">
                            </div>
                            <div class="col-md-8">
                                <div class="card-body">
                                    <h5 class="card-title">{{vino.nombre}}</h5>
                                    <p class="card-text">Tipo: {{vino.tipo}}</p>
                                    <p class="card-text"><small class="text-muted">D.O: {{vino.denominacion}}</small></p>
                                    <br/>
                                    <a href="{% url 'detalles' vino.id %}" class="btn boton">Ver vino</a>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block js %}

<script>

    $(document).ready(function()
    {
        var slider = document.getElementById("myRange");
        var output = document.getElementById("demo");
        output.innerHTML = slider.value;

        slider.oninput = function()
        {
            output.innerHTML = this.value;
        }
    });

    $(function() {
        'use strict';
    
        $('#f').on('submit', function() {
            
            var name = $("#tVino").val();

            $.get("{% url 'filtroVinoteca' %}", {"name": name}, function(data){
                var html = "";
                var n = data.length;
                var vId;
                $("#cartas").remove();
                $("#grupoVinos").append('<div class="card results" id="cartas">');
                for(var i = 0; i<n; i++){
                    var vId = data[i].id;
                    console.log(vId);
                    html+='<div class="row no-gutters">'
                                +'<div class="col-md-4">'
                                    +'<img src='+ data[i].img +' width="200" height="200" style="margin: 1em;" class="card-img" alt="...">'
                                +'</div>'
                                +'<div class="col-md-8">'    
                                    +'<div class="card-body">'
                                        +'<h5 class="card-title">'+ data[i].nombre +'</h5>'
                                        +'<p class="card-text">Tipo: '+ data[i].tipo +'</p>'
                                        +'<p class="card-text"><small class="text-muted">D.O: '+ data[i].denominacion +'</small></p>'
                                        +'</br>'
                                        +'<a href="../detalles/'+vId+'" class="btn boton">Ver Detalles</a>'
                                    +'</div>'
                                +'</div>'
                            +'</div>'
                        +'</div>';
                }
                $("#cartas").append(html);
            })
            return false;
        });
    });
</script>

{% endblock %}