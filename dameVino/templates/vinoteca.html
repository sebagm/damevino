{% extends "base.html" %}
{% load static %}

{% block title %} DameVino - Vinoteca {% endblock %}

{% block content %}

<div class="container-fluid px-5 py-5" >
    <div id="colD" class="row px-5 py-5" style="background-color: #a1ded6;">
        <div class="col-xs-12 col-sm-3 px-0" style="overflow-y: auto; max-height: 500px;">
            <form id="f" method="GET">
                <div class="accordion" id="acordeon">
                    <div class="card border-secondary">
                        <div class="card-header" id="headVino" style="height: 70px;">
                            <h2 class="mb-0">
                                <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseVino" aria-expanded="true" aria-controls="collapseVino">
                                    <span style="float: left;">Tipo de vino</span>
                                    <span style="float: rigth; margin-left: 100px;">
                                        <svg class="bi bi-chevron-down" width="0.7em" height="0.7em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"/>
                                        </svg>
                                    </span>
                                </button>
                            </h2>
                        </div>
                        <div id="collapseVino" class="collapse" aria-labelledby="headVino" data-parent="#acordeon">
                            <div id="divTipo" class="card-body" style="padding-left: 3.5em;">
                                <label><input type="checkbox" id="vinoTinto" name="vinos[]" value="Vino tinto"> Vino tinto</label><br/>
                                <label><input type="checkbox" id="vinoBlanco" name="vinos[]" value="Vino blanco"> Vino blanco</label><br/>
                                <label><input type="checkbox" id="vinoRosado" name="vinos[]" value="Vino rosado"> Vino rosado</label><br/>
                                <label><input type="checkbox" id="vinoEspumoso" name="vinos[]" value="Vino espumoso"> Vino espumoso</label><br/>
                                <label><input type="checkbox" id="vinoGeneroso" name="vinos[]" value="Vino generoso"> Vino generoso</label><br/>
                                <label><input type="checkbox" id="vinoDulce" name="vinos[]" value="Vino dulce"> Vino dulce</label><br/>
                            </div>
                        </div>
                    </div>
                    <div class="card border-secondary">
                        <div class="card-header" id="headDenom" style="height: 70px;">
                            <h2>
                                <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseDenom" aria-expanded="true" aria-controls="collapseDenom">
                                    <span style="float: left;">Denominación</span>
                                    <span style="float: rigth; margin-left: 78px;">
                                        <svg class="bi bi-chevron-down" width="0.7em" height="0.7em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"/>
                                        </svg>
                                    </span>
                                </button>
                            </h2>
                        </div>
                        <div id="collapseDenom" class="collapse" aria-labelledby="headDenom" data-parent="#acordeon">
                            <div id="divDO" class="card-body" style="padding-left: 3.5em;">
                                <label><input type="checkbox" id="Alicante" name="denominacion[]" value="Alicante"> Alicante</label><br/>
                                <label><input type="checkbox" id="Rioja" name="denominacion[]" value="Rioja"> Rioja</label><br/>
                                <label><input type="checkbox" id="Somontano" name="denominacion[]" value="Somontano"> Somontano</label><br/>
                                <label><input type="checkbox" id="Toro" name="denominacion[]" value="Toro"> Toro</label><br/>
                                <label><input type="checkbox" id="Manchuela" name="denominacion[]" value="Manchuela"> Manchuela</label><br/>
                                <label><input type="checkbox" id="VT_Castilla_y_León" name="denominacion[]" value="VT Castilla y León"> VT Castilla y León</label><br/>
                                <label><input type="checkbox" id="Ribera_del_Duero" name="denominacion[]" value="Ribera del Duero"> Ribera del Duero</label><br/>
                                <label><input type="checkbox" id="Rueda" name="denominacion[]" value="Rueda"> Rueda</label><br/>
                                <label><input type="checkbox" id="Jerez_Xérès_Sherry" name="denominacion[]" value="Jerez-Xérès-Sherry"> Jerez-Xérès-Sherry</label><br/>
                                <label><input type="checkbox" id="Rías_Baixas" name="denominacion[]" value="Rías Baixas"> Rías Baixas</label><br/>
                                <label><input type="checkbox" id="Calatayud" name="denominacion[]" value="Calatayud"> Calatayud</label><br/>
                                <label><input type="checkbox" id="Cava" name="denominacion[]" value="Cava"> Cava</label><br/>
                                <label><input type="checkbox" id="Corpinnat" name="denominacion[]" value="Corpinnat"> Corpinnat</label><br/>
                                <label><input type="checkbox" id="Bierzo" name="denominacion[]" value="Bierzo"> Bierzo</label><br/>
                                <label><input type="checkbox" id="Campo_De_Borja" name="denominacion[]" value="Campo De Borja"> Campo De Borja</label><br/>
                                <label><input type="checkbox" id="Yecla" name="denominacion[]" value="Yecla"> Yecla</label><br/>
                                <label><input type="checkbox" id="Montsant" name="denominacion[]" value="Montsant"> Montsant</label><br/>
                                <label><input type="checkbox" id="Jumilla" name="denominacion[]" value="Jumilla"> Jumilla</label><br/>
                                <label><input type="checkbox" id="Empordà" name="denominacion[]" value="Empordà"> Empordà</label><br/>
                                <label><input type="checkbox" id="Montilla_Moriles" name="denominacion[]" value="Montilla-Moriles"> Montilla-Moriles</label><br/>
                                <label><input type="checkbox" id="VT_Extremadura" name="denominacion[]" value="VT Extremadura"> VT Extremadura</label><br/>
                                <label><input type="checkbox" id="Manzanilla_Sanlúcar_de_Barrameda" name="denominacion[]" value="Manzanilla Sanlúcar de Barrameda"> Manzanilla Sanlúcar de Barrameda</label><br/>
                                <label><input type="checkbox" id="Madrid" name="denominacion[]" value="Madrid"> Madrid</label><br/>
                                <label><input type="checkbox" id="Navarra" name="denominacion[]" value="Navarra"> Navarra</label><br/>
                                <label><input type="checkbox" id="Priorat" name="denominacion[]" value="Priorat"> Priorat</label><br/>
                                <label><input type="checkbox" id="Tres_Riberas" name="denominacion[]" value="Tres Riberas"> Tres Riberas</label><br/>
                                <label><input type="checkbox" id="VT_EL_Terrerazo" name="denominacion[]" value="VT EL Terrerazo"> VT EL Terrerazo</label><br/>
                                <label><input type="checkbox" id="VT_Cádiz" name="denominacion[]" value="VT Cádiz"> VT Cádiz</label><br/>
                                <label><input type="checkbox" id="Ribeira_Sacra" name="denominacion[]" value="Ribeira Sacra"> Ribeira Sacra</label><br/>
                                <label><input type="checkbox" id="VT_Mallorca" name="denominacion[]" value="VT Mallorca"> VT Mallorca</label><br/>
                                <label><input type="checkbox" id="Valencia" name="denominacion[]" value="Valencia"> Valencia</label><br/>
                                <label><input type="checkbox" id="Sierras_de_Málaga" name="denominacion[]" value="Sierras de Málaga"> Sierras de Málaga</label><br/>
                            </div>
                        </div>
                    </div>
                    <div class="card border-secondary">
                        <div class="card-header" id="headMarid" style="height: 70px;">
                            <h2>
                                <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseMarid" aria-expanded="true" aria-controls="collapseMarid">
                                    <span style="float: left;">Maridaje</span>
                                    <span style="float: rigth; margin-left: 135px;">
                                        <svg class="bi bi-chevron-down" width="0.7em" height="0.7em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"/>
                                        </svg>
                                    </span>
                                </button>
                            </h2>
                        </div>
                        <div id="collapseMarid" class="collapse" aria-labelledby="headMarid" data-parent="#acordeon">
                            <div id="divMaridaje" class="card-body" style="padding-left: 3.5em;">
                                <label><input type="checkbox" id="Carne" name="maridaje[]" value="Carne"> Carne</label><br/>
                                <label><input type="checkbox" id="Ensalada" name="maridaje[]" value="Ensalada"> Ensalada</label><br/>
                                <label><input type="checkbox" id="Pescado" name="maridaje[]" value="Pescado"> Pescado</label><br/>
                                <label><input type="checkbox" id="Postres" name="maridaje[]" value="Postres"> Postres</label><br/>
                                <label><input type="checkbox" id="Pasta" name="maridaje[]" value="Pasta"> Pasta</label><br/>
                                <label><input type="checkbox" id="Queso" name="maridaje[]" value="Queso"> Queso</label><br/>
                                <label><input type="checkbox" id="Embutidos" name="maridaje[]" value="Embutidos"> Embutidos</label><br/>
                                <label><input type="checkbox" id="Platos_cuchara" name="maridaje[]" value="Platos cuchara"> Platos cuchara</label><br/>
                                <label><input type="checkbox" id="Verduras_legumbres_hortalizas" name="maridaje[]" value="Verduras legumbres hortalizas"> Verduras, legumbres y hortalizas</label><br/>
                                <label><input type="checkbox" id="Patatas" name="maridaje[]" value="Patatas"> Patatas</label><br/>
                                <label><input type="checkbox" id="Cocina_espanola" name="maridaje[]" value="Cocina espanola"> Cocina espanola</label><br/>
                                <label><input type="checkbox" id="Cocina_mediterránea" name="maridaje[]" value="Cocina mediterránea"> Cocina mediterránea</label><br/>
                                <label><input type="checkbox" id="Cocina_vegetariana" name="maridaje[]" value="Cocina vegetariana"> Cocina vegetariana</label><br/>
                                <label><input type="checkbox" id="Cocina_china" name="maridaje[]" value="Cocina china"> Cocina china</label><br/>
                                <label><input type="checkbox" id="Cocina_italiana" name="maridaje[]" value="Cocina italiana"> Cocina italiana</label><br/>
                                <label><input type="checkbox" id="Cocina_japonesa" name="maridaje[]" value="Cocina japonesa"> Cocina japonesa</label><br/>
                                <label><input type="checkbox" id="Cocina_india" name="maridaje[]" value="Cocina india"> Cocina india</label><br/>
                                <label><input type="checkbox" id="Setas" name="maridaje[]" value="Setas"> Setas</label><br/>
                                <label><input type="checkbox" id="Frutas" name="maridaje[]" value="Frutas"> Frutas</label><br/>
                                <label><input type="checkbox" id="Arroz" name="maridaje[]" value="Arroz"> Arroz</label><br/>
                                <label><input type="checkbox" id="Aperitivos" name="maridaje[]" value="Aperitivos"> Aperitivos</label><br/>
                                <label><input type="checkbox" id="Marisco" name="maridaje[]" value="Marisco"> Marisco</label><br/>
                                <label><input type="checkbox" id="Huevos" name="maridaje[]" value="Huevos"> Huevos</label><br/>
                                <label><input type="checkbox" id="Tapas" name="maridaje[]" value="Tapas"> Tapas</label><br/>
                                <label><input type="checkbox" id="Platos_Combinados" name="maridaje[]" value="Platos Combinados"> Platos Combinados</label><br/>
                                <label><input type="checkbox" id="Pate_foie" name="maridaje[]" value="Pate foie"> Pate foie</label><br/>
                            </div>
                        </div>
                    </div>
                    <div class="card border-secondary">
                        <div class="card-header" id="headP" style="height: 70px;">
                            <h2>
                                <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseP" aria-expanded="true" aria-controls="collapseP">
                                    <span style="float: left;">Puntuación</span>
                                    <span style="float: rigth; margin-left: 110px;">
                                        <svg class="bi bi-chevron-down" width="0.7em" height="0.7em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"/>
                                        </svg>
                                    </span>
                                </button>
                            </h2>
                        </div>
                        <div id="collapseP" class="collapse show" aria-labelledby="headP" data-parent="#acordeon">
                            <div class="card-body">
                                <div class="slidecontainer">
                                    <input type="range" min="85" max="100" value="100" class="slider" id="miRango">
                                    <p>Puntos: <span id="puntuacion"></span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="list-group py-2">
                    <button type="submit" class="btn botonFiltro">Aplicar filtros</button>
                    <button class="btn botonFiltro mt-2" onclick=borrarFiltro()>Borrar filtros</button>
                </div>
            </form>
        </div>
        <div class="col-xs-12 col-sm-9 d-flex justify-content-end" id="grupoVinos">
            <div id="cartas" style="overflow-y: auto; max-height: 500px; width: 95%;">
                {% if vinos %}
                    {% for vino in vinos %}
                        <div class="card border-secondary mb-1">
                            <div class="row no-gutters">
                                <div class="col-xs-10 col-md-4">
                                    <img src={{vino.img}} width="135" height="200" style="margin: 1em;" class="card-img" alt="...">
                                </div>
                                <div class="col-md-8">
                                    <div class="card-body">
                                        <h5 class="card-title" style="font-size: 2em;">{{vino.nombre}}</h5>
                                        <p class="card-text" style="font-size: 1.2em;"><small class="text-muted">Tipo: {{vino.tipo}}</small></p>
                                        <p class="card-text" style="font-size: 1.2em;"><small class="text-muted">D.O: {{vino.denominacion}}</small></p>
                                        <br/>
                                        <a href="{% url 'detalles' vino.id %}" target="_blank" class="btn boton">Ver detalles</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block js %}

<script>

    $(document).ready(function()
    {
        var slider = document.getElementById("miRango");
        var output = document.getElementById("puntuacion");
        output.innerHTML = slider.value;

        slider.oninput = function()
        {
            output.innerHTML = this.value;
        }
    });

    $(function() {
        'use strict';
    
        $('#f').on('submit', function() {
            
            var fDivTipo = "";
            var fDivDO = "";
            var fDivMaridaje = "";
            var fPuntuacion = $("#puntuacion").text();

            $("#divTipo input[type=checkbox]").each(function(){
                if(this.checked)
                    fDivTipo += $(this).val()+", ";
            })

            $("#divDO input[type=checkbox]").each(function(){
                if(this.checked)
                    fDivDO += $(this).val()+", ";
            })

            $("#divMaridaje input[type=checkbox]").each(function(){
                if(this.checked)
                    fDivMaridaje += $(this).val()+", ";
            })

            $.get("{% url 'filtroVinoteca' %}", {"fDivTipo": fDivTipo, "fDivDO": fDivDO, "fDivMaridaje": fDivMaridaje, "fPuntuacion":fPuntuacion}, function(data){
                var html = "";
                var n = data.length;
                var vId;
                $("#cartas").empty();
                if (n > 0)
                {
                    for(var i = 0; i<n; i++)
                    {
                        var vId = data[i].id;
                        html+='<div class="card border-secondary mb-1">'
                                +'<div class="row no-gutters">'
                                        +'<div class="col-xs-10 col-md-4">'
                                            +'<img src='+ data[i].img +' width="135" height="200" style="margin: 1em;" class="card-img" alt="...">'
                                        +'</div>'
                                        +'<div class="col-md-8">'    
                                            +'<div class="card-body">'
                                                +'<h5 class="card-title" style="font-size: 2em;">'+ data[i].nombre +'</h5>'
                                                +'<p class="card-text" style="font-size: 1.2em;"><small class="text-muted">Tipo: '+ data[i].tipo +'</small></p>'
                                                +'<p class="card-text" style="font-size: 1.2em;"><small class="text-muted">D.O: '+ data[i].denominacion +'</small></p>'
                                                +'</br>'
                                                +'<a href="../detalles/'+vId+'" target="_blank" class="btn boton">Ver Detalles</a>'
                                            +'</div>'
                                        +'</div>'
                                    +'</div>'
                                +'</div>'
                            +'</div>';
                    }
                }
                else
                {
                    html+="<div><h2 class=\"text-center\"><span>No hay resultados</span></h2></div>";
                }
                $("#cartas").append(html);
            })
            return false;
        });
    });
</script>

{% endblock %}